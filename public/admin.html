<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - User Management</title>
    <link rel="stylesheet" href="/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        .page-header {
            background: linear-gradient(135deg, var(--error-600) 0%, var(--error-800) 100%);
            color: white;
            padding: var(--space-8) 0;
            margin-bottom: var(--space-8);
            border-radius: 0 0 var(--radius-2xl) var(--radius-2xl);
        }
        
        .page-header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: var(--space-2);
            display: flex;
            align-items: center;
            gap: var(--space-4);
        }
        
        .page-header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.125rem;
            margin: 0;
        }
        
        @media (max-width: 768px) {
            .page-header h1 {
                font-size: 2rem;
            }
        }
    </style>
    <script src="/js/util.js"></script>
    <script src="/js/auth-guard.js"></script>
</head>
<body>
    <header>
        <div class="container">
            <h1><i class="fas fa-graduation-cap"></i> Student Management System</h1>
            <nav>
                <a href="/index.html"><i class="fas fa-home"></i> Dashboard</a>
                <a href="/students.html"><i class="fas fa-users"></i> Students</a>
                <a href="/fees.html"><i class="fas fa-dollar-sign"></i> Fees</a>
                <a href="/attendance.html"><i class="fas fa-calendar-check"></i> Attendance</a>
                <a href="/attendance-bulk.html"><i class="fas fa-calendar-alt"></i> Bulk Attendance</a>
                <a href="/reports.html"><i class="fas fa-chart-bar"></i> Reports</a>
                <a href="/classes.html"><i class="fas fa-school"></i> Classes</a>
                <a href="/marks.html"><i class="fas fa-graduation-cap"></i> Marks</a>
                <a href="/invoices.html"><i class="fas fa-file-invoice"></i> Invoices</a>
                <a href="/import-export.html"><i class="fas fa-download"></i> Import/Export</a>
                <a href="/admin.html" class="active"><i class="fas fa-cog"></i> Admin</a>
                <button onclick="logout()" class="btn btn-secondary"><i class="fas fa-sign-out-alt"></i> Logout</button>
            </nav>
        </div>
    </header>
    <main>
        <div class="container">
            <!-- Page Header -->
            <div class="page-header">
                <div class="container">
                    <h1><i class="fas fa-cog"></i> Admin - User Management</h1>
                    <p>Manage system users, roles, and administrative settings</p>
                </div>
            </div>
		<section class="card" style="max-width:520px;">
			<h3>Create User</h3>
			<form id="user-form">
				<input placeholder="Username" id="username" required />
				<input placeholder="Password" id="password" type="password" required />
				<select id="role">
					<option value="admin">admin</option>
					<option value="teacher">teacher</option>
				</select>
				<button type="submit">Create</button>
			</form>
		</section>
		<section>
			<h3>Users</h3>
			<table>
				<thead><tr><th>ID</th><th>Username</th><th>Role</th><th>Actions</th></tr></thead>
				<tbody id="users-body"></tbody>
			</table>
		</section>
	</main>
	<script>
		ensureAuth();
		async function loadUsers(){
			const list = await apiFetch('/api/users');
			const body = document.getElementById('users-body');
			body.innerHTML = '';
			for(const u of list){
				const tr = document.createElement('tr');
				tr.innerHTML = `<td>${u.USER_ID}</td><td>${u.USERNAME}</td><td>${u.ROLE}</td><td><button data-id="${u.USER_ID}" class="del danger">Delete</button></td>`;
				body.appendChild(tr);
			}
			body.querySelectorAll('.del').forEach(btn=>btn.addEventListener('click', async (e)=>{
				const id = e.target.getAttribute('data-id');
				if(!confirm('Delete this user?')) return;
				await apiFetch(`/api/users/${id}`, { method: 'DELETE' });
				window.showToast('Deleted');
				loadUsers();
			}));
		}
		document.getElementById('user-form').addEventListener('submit', async (e)=>{
			e.preventDefault();
			const payload = { username: username.value, password: password.value, role: role.value };
			try{
				await apiFetch('/api/users', { method: 'POST', body: JSON.stringify(payload) });
				window.showToast('User created');
				username.value=''; password.value='';
				loadUsers();
			}catch(err){ window.showToast(err.message || 'Error'); }
		});
		loadUsers();
	</script>
</body>
</html>

